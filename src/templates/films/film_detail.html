{% extends "page.html" %}
{% load i18n %}


{% block head %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery.raty.min.js"></script>
{% endblock %}

{% block content %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <h2 class="pull-right">{{ film.score|floatformat:1 }}</h2>


            <h3>{{ film.title }}</h3>
        </div>
        <div class="panel-body">
            <img src="{{ MEDIA_URL }}{{ film.get_poster }}"
                 class="big-poster img-responsive pull-right"
                 alt="{{ film.title }}"/>

            <div class="container-fluid">
                <dl>
                    <dt>Id</dt>
                    <dd>{{ film.film_id }}</dd>
                    <dt>IMDB ID</dt>
                    <dd>{{ film.imdb_id }}</dd>
                    <dt>Year</dt>
                    <dd>{{ film.year }}</dd>
                    <dt>Genre</dt>
                    <dd>{{ film.genres.all|join:", " }}</dd>
                    <dt>Runtime</dt>
                    <dd>{{ film.runtime }}</dd>
                    <dt>Rating</dt>
                    <dd>{{ film.rating }}</dd>
                    <dt>Director</dt>
                    <dd>{{ film.directors.all|join:", " }}</dd>
                    <dt>Writer</dt>
                    <dd>{{ film.writers.all|join:", " }}</dd>
                    <dt>Cast</dt>
                    <dd>{{ film.casts.all|join:", " }}</dd>
                    <dt>Country</dt>
                    <dd>{{ film.countries.all|join:", " }}</dd>
                    <dt>Language</dt>
                    <dd>{{ film.languages.all|join:", " }}</dd>
                    <dt>Released</dt>
                    <dd>{{ film.released|date }}</dd>
                    <dt>Fullplot</dt>
                    <dd class="justify">{{ film.fullplot }}</dd>
                </dl>
            </div>

            <div class="clearfix"></div>
            <hr>
            <div class="container-fluid">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h5>{% trans 'Reviews' %}</h5>
                    </div>
                    <div class="panel-body">
                        {% for review in film.reviews %}
                            {{ review.text }}
                            <hr>
                        {% empty %}
                            {% trans 'No reviews' %}
                        {% endfor %}
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script type="text/javascript">
        {% if film.preference %}
            var not_rated = false;
        {% else %}
            var not_rated = true;
        {% endif %}
        $("#star{{ film.film_id }}").raty({
            score: {{ film.preference|default:"0" }},
            starOff: '{{ STATIC_URL }}img/star-off.png',
            starOn: '{{ STATIC_URL }}img/star-on.png',
            click: function (score, evt) {
                if (not_rated) {
                    var n_votes = $("#n_votes");
                    n = parseInt(n_votes.text()) + 1;
                    n_votes.text(n);
                    not_rated = false;
                }
                $.ajax({
                    url: "{% url 'films:rate' %}?film={{ film.film_id }}&score=" + score
                });
            }
        });

    </script>

{% endblock %}
