{% extends "page.html" %}
{% load i18n %}

{% block head %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/jquery.raty.min.js"></script>
{% endblock %}

{% block inner %}
    <div class="col-xs-12">
        <h1>{{ film.title }}</h1>
        <hr/>
        <div class="row">
            <div class="col-xs-12 col-sm-3">
                {% if film.poster %}
                    <img src="{{ film.poster }}" class="img-responsive"/>
                {% else %}
                    <img src="{{ STATIC_URL }}img/noposter200.png" class="img-responsive"/>
                {% endif %}
            </div>
            <div class="pull-right">
                <h1>
                    {% if film.score %}
                        {{ film.score|floatformat:1 }}
                    {% else %}
                        --
                    {% endif %}
                </h1>

                <p><span id="n_votes">{{ film.n_votes }}</span> votes</p>

                <div id="star{{ film.film_id }}"></div>
            </div>
            <div class="col-xs-12 col-sm-9">
                <dl class="dl-horizontal">
                    <dt>Id</dt>
                    <dd>{{ film.film_id }}</dd>
                    <dt>Year</dt>
                    <dd>{{ film.year }}</dd>
                    <dt>Genre</dt>
                    <dd>{{ film.genre.all|join:", " }}</dd>
                    <dt>Runtime</dt>
                    <dd>{{ film.runtime }}</dd>
                    <dt>Rating</dt>
                    <dd>{{ film.rating }}</dd>
                    <dt>Director</dt>
                    <dd>{{ film.director.all|join:", " }}</dd>
                    <dt>Writer</dt>
                    <dd>{{ film.writer.all|join:", " }}</dd>
                    <dt>Cast</dt>
                    <dd>{{ film.cast.all|join:", " }}</dd>
                    <dt>Released</dt>
                    <dd>{{ film.released|date }}</dd>
                    <dt>Plot</dt>
                    <dd class="justify">{{ film.plot }}</dd>
                    <dt>Fullplot</dt>
                    <dd class="justify">{{ film.fullplot }}</dd>
                </dl>
            </div>
        </div>
        <!-- /.row -->
    </div><!-- /.col-xs-12 -->

    <script type="text/javascript">
        {% if not score %}
            var not_rated = true;
        {% else %}
            var not_rated = false;
        {% endif %}
        $("#star{{ film.film_id }}").raty({
            {% if score %}
                score: {{ score }},
            {% else %}
                score: 0,
            {% endif %}
            starOff: '{{ STATIC_URL }}img/star-off.png',
            starOn: '{{ STATIC_URL }}img/star-on.png',
            click: function (score, evt) {
                if (not_rated) {
                    n = parseInt($("#n_votes").text()) + 1;
                    $("#n_votes").text(n);
                    not_rated = false;
                }
                $.ajax({
                    url: "/rate/?film={{ film.film_id }}&score=" + score,
                });
            }
        });
    </script>

{% endblock %}
